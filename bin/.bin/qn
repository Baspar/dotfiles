#!/bin/bash

#PARAMS
EDITOR="nvim"
DIR="$HOME/.notes/"
DEFAULT_VALUE="\n\n# vim: syntax=markdown"


FILES=$(ls "$DIR")
RELATIVE_SELECTED_FILE=$(echo -e "$FILES" | rofi -i -dmenu -font 'MonofurForPowerline Nerd Font 30' -theme '/home/baspar/.bin/theme.rasi' -fullscreen -mesg 'Type your note name' -matching fuzzy)
SELECTED_FILE="$DIR/$RELATIVE_SELECTED_FILE"

# If option is selected
if [ "$RELATIVE_SELECTED_FILE" ]
then
    # Prefill new notes if needed
    if [[ ! -e "$SELECTED_FILE"  && "$DEFAULT_VALUE" ]]
    then
        echo -e "$DEFAULT_VALUE" >> "$SELECTED_FILE"
    fi

    # Launch editor
    termite -e "$EDITOR '$SELECTED_FILE'"

    # Remove if empty
    if [[ ! "$(cat '$SELECTED_FILE')" ]]
    then
        rm "$SELECTED_FILE"
    fi
fi
